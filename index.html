<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Калькулятор пенсії</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f4f4f4;
        }
        .calculator {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
        }
        select, input[type="number"], input[type="radio"] {
            margin: 5px 0;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        .result {
            margin-top: 20px;
            font-size: 1.2em;
            font-weight: bold;
        }
        .note {
            font-size: 0.9em;
            color: #555;
        }
    </style>
</head>
<body>
    <div class="calculator">
        <h1>Калькулятор пенсії</h1>
        <div class="form-group">
            <label for="Your-structure">Ваша структура:</label>
            <select id="Your-structure">
                <option value="Служба безпеки України">Служба безпеки України</option>
                <option value="Збройні сили України">Збройні сили України</option>
                <option value="Національна поліція">Національна поліція</option>
            </select>
        </div>
        <div class="form-group">
            <label for="Your-rank">Ваше звання:</label>
            <select id="Your-rank">
                <option value="Полковник">Полковник</option>
                <option value="Солдат">Солдат</option>
                <option value="Лейтенант">Лейтенант</option>
            </select>
        </div>
        <div class="form-group">
            <button id="nextBtn1">Далі</button>
        </div>
        <div class="form-group" id="step2" style="display: none;">
            <label>Років вислуги:</label>
            <span class="pages-number">32</span>
            <div class="year-wrap">
                <label><input type="radio" name="year" id="2011" checked> До жовтня 2011 року</label>
                <label><input type="radio" name="year" id="2011-2014"> Від жовтня 2011 до квітня 2014 року</label>
                <label><input type="radio" name="year" id="2014-2018"> Після квітня 2014 року до березня 2018 року</label>
                <label><input type="radio" name="year" id="2018"> Від березня 2018 року</label>
            </div>
            <div class="chornobylec">
                <label><input type="radio" name="chornobylec" id="noChorn" checked> Ні</label>
                <label><input type="radio" name="chornobylec" id="firstCategoy"> Так, 1 категорія</label>
                <label><input type="radio" name="chornobylec" id="secondCategoy"> Так, 2 категорія</label>
            </div>
            <button id="backBtn1">Назад</button>
            <button id="nextBtn2">Далі</button>
        </div>
        <div class="form-group" id="step3" style="display: none;">
            <label for="typeofpension">Ваш вид пенсії:</label>
            <select id="typeofpension">
                <option value="За вислугою років">За вислугою років</option>
                <option value="По інвалідності">По інвалідності</option>
                <option value="Звільнення у зв'язку зі станом здоров'я">Звільнення у зв'язку зі станом здоров'я</option>
                <option value="За змішаним стажем">За змішаним стажем</option>
                <option value="По втраті годувальника">По втраті годувальника</option>
            </select>
            <label for="The-size-of-the-pension">Розмір пенсії (грн):</label>
            <input type="number" id="The-size-of-the-pension" value="23610">
            <div class="dovidka">
                <label><input type="radio" name="dovidka" id="radio-2" checked> Немає довідки</label>
                <label><input type="radio" name="dovidka" id="radio-3"> Є довідка про г/з</label>
            </div>
            <div id="dovidkaValueField" style="display: none;">
                <label for="field-25">Розмір грошового забезпечення з довідки (грн):</label>
                <input type="number" id="field-25" value="0">
            </div>
            <button id="backBtn2">Назад</button>
            <button id="resultBtn">Розрахувати</button>
        </div>
        <div class="result price" style="display: none;"></div>
        <div class="note" style="display: none;">
            Дана сума не враховує виплати на неповнолітніх дітей, гірські, за УБД та інших надбавок. Тому Ваша пенсія може бути ще більше.
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", (event) => {
            console.log('script loaded');

            // Отримуємо посилання на елементи
            const pagesNumberElement = document.querySelector('.pages-number');
            const zvanieVal = document.getElementById('Your-rank');
            const strVal = document.getElementById('Your-structure');
            const pensiaVal = document.getElementById('The-size-of-the-pension');
            const civilyearsVal = document.getElementById('civilyears');
            const waryearsVal = document.getElementById('waryears');
            const dovidkaVal = document.getElementById('field-25');
            const pensTypeVal = document.getElementById('typeofpension');
            const nextBtn1 = document.getElementById('nextBtn1');
            const nextBtn2 = document.getElementById('nextBtn2');
            const backBtn1 = document.getElementById('backBtn1');
            const backBtn2 = document.getElementById('backBtn2');
            const resultBtn = document.getElementById('resultBtn');
            const step2 = document.getElementById('step2');
            const step3 = document.getElementById('step3');
            const resultDiv = document.querySelector('.result.price');
            const noteDiv = document.querySelector('.note');
            const dovidkaValueField = document.getElementById('dovidkaValueField');

            // Глобальні змінні
            let lastNumber;
            let zvanieValue;
            let strValue;
            let pensTypeValue;
            let pensiaValue;
            let civilyearsValue = 0;
            let waryearsValue = 0;
            let loan;
            let dovidkaValue = 0;
            let calculatePension;
            let year = null;
            let chernobylec = null;
            let health = null;
            let invalidnist = null;
            let invGroup = null;
            let dovidka = null;
            let pensValue = null;
            let vtrata = null;

            // Функція для оновлення числа вислуги
            function updateNumber() {
                const newNumber = parseInt(pagesNumberElement.textContent);
                if (newNumber !== lastNumber) {
                    lastNumber = newNumber;
                    console.log('Змінено число на:', lastNumber);
                }
            }

            // Спостереження за змінами числа вислуги
            const observer = new MutationObserver(updateNumber);
            observer.observe(pagesNumberElement, { characterData: true, subtree: true });
            updateNumber();

            // Функція для оновлення loan
            const updateLoan = (strValue, zvanieValue) => {
                const loanMappings = {
                    'Служба безпеки України': {
                        'Полковник': 35430,
                        'Солдат': 9870,
                        'Лейтенант': 13450
                    },
                    'Збройні сили України': {
                        'Полковник': 20233,
                        'Солдат': 9870,
                        'Лейтенант': 13450
                    },
                    'Національна поліція': {
                        'Полковник': 35430,
                        'Солдат': 9870,
                        'Лейтенант': 13450
                    }
                };
                if (loanMappings[strValue] && loanMappings[strValue][zvanieValue]) {
                    loan = loanMappings[strValue][zvanieValue];
                } else {
                    loan = 0;
                }
                console.log('loan :', loan);
                return loan;
            };

            // Функції оновлення значень
            function zvanieUpdate() {
                const newSelectedValue = zvanieVal.value;
                if (newSelectedValue !== zvanieValue) {
                    zvanieValue = newSelectedValue;
                    console.log('Змінено вибір на:', zvanieValue);
                }
            }

            function strUpdate() {
                const newSelectedValue = strVal.value;
                if (newSelectedValue !== strValue) {
                    strValue = newSelectedValue;
                    console.log('Змінено вибір на:', strValue);
                }
            }

            function pensTypeUpdate() {
                const newSelectedValue = pensTypeVal.value;
                if (newSelectedValue !== pensTypeValue) {
                    pensTypeValue = newSelectedValue;
                    console.log('Змінено вибір на:', pensTypeValue);
                }
            }

            function pensUpdate() {
                const newSelectedValue = parseFloat(pensiaVal.value);
                if (!isNaN(newSelectedValue) && newSelectedValue !== pensiaValue) {
                    pensiaValue = newSelectedValue;
                    console.log('Змінено вибір на:', pensiaValue);
                }
            }

            function dovidkaUpdate() {
                const newSelectedValue = parseFloat(dovidkaVal.value);
                if (!isNaN(newSelectedValue) && newSelectedValue !== dovidkaValue) {
                    dovidkaValue = newSelectedValue;
                    console.log('Змінено вибір на:', dovidkaValue);
                }
            }

            function civilUpdate() {
                const newSelectedValue = parseFloat(civilyearsVal?.value || 0);
                if (!isNaN(newSelectedValue) && newSelectedValue !== civilyearsValue) {
                    civilyearsValue = newSelectedValue;
                    console.log('Змінено вибір на:', civilyearsValue);
                }
            }

            function warUpdate() {
                const newSelectedValue = parseFloat(waryearsVal?.value || 0);
                if (!isNaN(newSelectedValue) && newSelectedValue !== waryearsValue) {
                    waryearsValue = newSelectedValue;
                    console.log('Змінено вибір на:', waryearsValue);
                }
            }

            // Ініціалізація вибору року
            function initYearSelection() {
                let checkboxes = document.querySelectorAll('.year-wrap input[type="radio"]');
                checkboxes.forEach(function(checkbox) {
                    checkbox.addEventListener('change', function() {
                        if (checkbox.checked) {
                            year = checkbox.getAttribute('id');
                            console.log(year);
                        }
                    });
                });
                return year;
            }

            // Ініціалізація вибору чорнобильця
            function initChornSelection() {
                let checkboxes = document.querySelectorAll('.chornobylec input[type="radio"]');
                checkboxes.forEach(function(checkbox) {
                    checkbox.addEventListener('change', function() {
                        if (checkbox.checked) {
                            chernobylec = checkbox.getAttribute('id');
                            if (chernobylec === "firstCategoy") {
                                chernobylec = 1;
                            } else if (chernobylec === "secondCategoy") {
                                chernobylec = 0.95;
                            } else {
                                chernobylec = 0;
                            }
                            console.log(chernobylec);
                        }
                    });
                });
                return chernobylec;
            }

            // Ініціалізація вибору довідки
            function initDovidkaSelection() {
                let checkboxes = document.querySelectorAll('.dovidka input[type="radio"]');
                checkboxes.forEach(function(checkbox) {
                    checkbox.addEventListener('change', function() {
                        if (checkbox.checked) {
                            dovidka = checkbox.getAttribute('id');
                            dovidkaValueField.style.display = dovidka === 'radio-3' ? 'block' : 'none';
                            console.log(dovidka);
                        }
                    });
                });
                return dovidka;
            }

            // Об'єкт для вибору інвалідності
            let invSelection = {
                invalidnist: "",
                invGroup: "",
                initInvalidnistSelection: function () {
                    let checkboxes = document.querySelectorAll('.invalidnist input[type="radio"]');
                    checkboxes.forEach(function (checkbox) {
                        checkbox.addEventListener('change', function () {
                            if (checkbox.checked) {
                                invSelection.invalidnist = checkbox.getAttribute('id');
                                console.log(invSelection.invalidnist);
                            }
                        });
                    });
                },
                initInvGroupSelection: function () {
                    let checkboxes = document.querySelectorAll('.inv-group input[type="radio"]');
                    checkboxes.forEach(function (checkbox) {
                        checkbox.addEventListener('change', function () {
                            if (checkbox.checked) {
                                invSelection.invGroup = checkbox.getAttribute('id');
                                console.log(invSelection.invGroup);
                            }
                        });
                    });
                },
                updateInvPercent: function () {
                    let invPercentMap = {
                        "army": {
                            "1-3": 0.7,
                            "2-3": 0.6,
                            "3": 0.4
                        },
                        "war": {
                            "1-3": 1,
                            "2-3": 0.8,
                            "3": 0.6
                        }
                    };
                    if (invPercentMap[invSelection.invalidnist] && invPercentMap[invSelection.invalidnist][invSelection.invGroup]) {
                        let invPercent = invPercentMap[invSelection.invalidnist][invSelection.invGroup];
                        console.log(invSelection.invalidnist, invSelection.invGroup, invPercent);
                        return invPercent;
                    } else {
                        return 0;
                    }
                }
            };

            // Функція для обчислення відсотка пенсії
            function updatePensValue() {
                zvanieUpdate();
                strUpdate();
                pensUpdate();
                civilUpdate();
                warUpdate();
                updateNumber();
                dovidkaUpdate();
                pensTypeUpdate();
                let invPercent = invSelection.updateInvPercent();
                let mixedVal = civilyearsValue + waryearsValue;
                console.log(mixedVal);
                let pensValue = 0;
                console.log(`invPercent: ${invPercent}`);
                console.log(`Initial pensValue: ${pensValue}`);
                console.log(`Initial pensValue: ${chernobylec}`);
                if (pensTypeValue === "За вислугою років") {
                    console.log(`Тип пенсії: ${pensTypeValue}`);
                    let years = lastNumber - 20;
                    years = years * 3;
                    pensValue = 50 + years;
                    pensValue = pensValue / 100;
                    if (year === '2011' && pensValue > 0.8) {
                        if (chernobylec === 1) {
                            pensValue = Math.min(pensValue, 1);
                        } else if (chernobylec === 0.95) {
                            pensValue = Math.min(pensValue, 0.95);
                        } else {
                            pensValue = Math.min(pensValue, 0.8);
                        }
                    } else if (year === '2011-2014' && pensValue > 0.9) {
                        if (chernobylec === 1) {
                            pensValue = Math.min(pensValue, 1);
                        } else if (chernobylec === 0.95) {
                            pensValue = Math.min(pensValue, 0.95);
                        } else {
                            pensValue = Math.min(pensValue, 0.9);
                        }
                    } else if (year === '2014-2018' && pensValue > 0.7) {
                        if (chernobylec === 1) {
                            pensValue = Math.min(pensValue, 1);
                        } else if (chernobylec === 0.95) {
                            pensValue = Math.min(pensValue, 0.95);
                        } else {
                            pensValue = Math.min(pensValue, 0.7);
                        }
                    } else if (year === '2018' && pensValue > 0.7) {
                        if (chernobylec === 1) {
                            pensValue = pensValue + 0.2;
                            pensValue = Math.min(pensValue, 1);
                        } else if (chernobylec === 0.95) {
                            pensValue = pensValue + 0.2;
                            pensValue = Math.min(pensValue, 0.95);
                        } else if (strValue === 'Міліція (МВС)' || strValue === 'Національна поліція') {
                            pensValue = Math.min(pensValue, 0.7);
                        } else {
                            pensValue = Math.min(pensValue, 0.7) + 0.2;
                        }
                    } else {
                        pensValue = pensValue;
                    }
                }
                pensValue = Number(pensValue);
                console.log(`Процент который нам нужен: ${pensValue}`);
                return pensValue;
            }

            // Функція для обчислення пенсії
            calculatePension = function() {
                zvanieUpdate();
                strUpdate();
                pensUpdate();
                civilUpdate();
                warUpdate();
                updateNumber();
                dovidkaUpdate();
                pensTypeUpdate();
                let pensValue = updatePensValue();
                let invPercent = invSelection.updateInvPercent();
                console.log(`Процент который нам нужен в начале просчета пенсии: ${pensValue}`);
                let loan = updateLoan(strValue, zvanieValue);
                let result = 0;
                if (pensTypeValue === "За вислугою років") {
                    if (dovidka === "radio-3") {
                        result = dovidkaValue * pensValue;
                        console.log(`result вислуга: ${result}`);
                    } else if (dovidka === "radio-2") {
                        result = loan * pensValue;
                        console.log(`вислуга без довідки: ${result}`);
                    }
                    result = result + 0.14 * result;
                    console.log(`result: ${result}`);
                    let preResult = result * 0.197;
                    console.log(`pre-result: ${preResult}`);
                    if (preResult > 1500) {
                        preResult = 1500;
                    }
                    console.log(`pre-result: ${preResult}`);
                    result = preResult + result;
                }
                if (year !== '2018') {
                    console.log(`проверка на добавленние 2к грн(перед добавлением) - ${result}`);
                    result = result + 2000;
                    console.log(`проверка на добавленние 2к грн(после добавления) - ${result}`);
                }
                console.log(`результат перед возвратом функции - ${result}`);
                return result;
            };

            // Обробники подій для навігації
            nextBtn1.addEventListener('click', () => {
                step2.style.display = 'block';
                nextBtn1.style.display = 'none';
            });

            backBtn1.addEventListener('click', () => {
                step2.style.display = 'none';
                nextBtn1.style.display = 'block';
            });

            nextBtn2.addEventListener('click', () => {
                step3.style.display = 'block';
                step2.style.display = 'none';
            });

            backBtn2.addEventListener('click', () => {
                step3.style.display = 'none';
                step2.style.display = 'block';
            });

            // Обробник для кнопки "Розрахувати"
            resultBtn.addEventListener('click', function (e) {
                zvanieUpdate();
                strUpdate();
                pensUpdate();
                civilUpdate();
                warUpdate();
                updateNumber();
                dovidkaUpdate();
                pensTypeUpdate();
                let pensValue = updatePensValue();
                let invPercent = invSelection.updateInvPercent();
                let loan = updateLoan(strValue, zvanieValue);
                console.log(`Грошове забезпечення:${loan}, 
                    роки звільнення: ${year}, 
                    Чи є чорнобильське?: ${chernobylec}, 
                    Звання: ${zvanieValue}, 
                    Структура: ${strValue}, 
                    Розмір пенсії: ${pensiaValue}, 
                    Роки вислуги: ${lastNumber}, 
                    Відсоток з інвалідності: ${invPercent}, 
                    Розмір грошового забезбечення з довідки: ${dovidkaValue}, 
                    Вид пенсії: ${pensTypeValue}`);
                let result = calculatePension();
                result = Math.round(result);
                resultDiv.innerText = `${result} грн`;
                resultDiv.style.display = 'block';
                noteDiv.style.display = 'block';
                console.log(`результат пенсії: ${result} грн`);
            });

            // Ініціалізація
            initYearSelection();
            initChornSelection();
            initDovidkaSelection();
            zvanieUpdate();
            strUpdate();
            pensUpdate();
            civilUpdate();
            warUpdate();
            dovidkaUpdate();
            pensTypeUpdate();
        });
    </script>
</body>
</html>
